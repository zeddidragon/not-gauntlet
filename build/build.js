(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var Stringify=require("./stringify");var Parse=require("./parse");module.exports={stringify:Stringify,parse:Parse}},{"./parse":2,"./stringify":3}],2:[function(require,module,exports){"use strict";var Utils=require("./utils");var internals={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3,strictNullHandling:false,plainObjects:false,allowPrototypes:false,allowDots:false};internals.parseValues=function(str,options){var obj={};var parts=str.split(options.delimiter,options.parameterLimit===Infinity?undefined:options.parameterLimit);for(var i=0;i<parts.length;++i){var part=parts[i];var pos=part.indexOf("]=")===-1?part.indexOf("="):part.indexOf("]=")+1;if(pos===-1){obj[Utils.decode(part)]="";if(options.strictNullHandling){obj[Utils.decode(part)]=null}}else{var key=Utils.decode(part.slice(0,pos));var val=Utils.decode(part.slice(pos+1));if(Object.prototype.hasOwnProperty.call(obj,key)){obj[key]=[].concat(obj[key]).concat(val)}else{obj[key]=val}}}return obj};internals.parseObject=function(chain,val,options){if(!chain.length){return val}var root=chain.shift();var obj;if(root==="[]"){obj=[];obj=obj.concat(internals.parseObject(chain,val,options))}else{obj=options.plainObjects?Object.create(null):{};var cleanRoot=root[0]==="["&&root[root.length-1]==="]"?root.slice(1,root.length-1):root;var index=parseInt(cleanRoot,10);if(!isNaN(index)&&root!==cleanRoot&&String(index)===cleanRoot&&index>=0&&(options.parseArrays&&index<=options.arrayLimit)){obj=[];obj[index]=internals.parseObject(chain,val,options)}else{obj[cleanRoot]=internals.parseObject(chain,val,options)}}return obj};internals.parseKeys=function(givenKey,val,options){if(!givenKey){return}var key=options.allowDots?givenKey.replace(/\.([^\.\[]+)/g,"[$1]"):givenKey;var parent=/^([^\[\]]*)/;var child=/(\[[^\[\]]*\])/g;var segment=parent.exec(key);var keys=[];if(segment[1]){if(!options.plainObjects&&Object.prototype.hasOwnProperty(segment[1])){if(!options.allowPrototypes){return}}keys.push(segment[1])}var i=0;while((segment=child.exec(key))!==null&&i<options.depth){i+=1;if(!options.plainObjects&&Object.prototype.hasOwnProperty(segment[1].replace(/\[|\]/g,""))){if(!options.allowPrototypes){continue}}keys.push(segment[1])}if(segment){keys.push("["+key.slice(segment.index)+"]")}return internals.parseObject(keys,val,options)};module.exports=function(str,opts){var options=opts||{};options.delimiter=typeof options.delimiter==="string"||Utils.isRegExp(options.delimiter)?options.delimiter:internals.delimiter;options.depth=typeof options.depth==="number"?options.depth:internals.depth;options.arrayLimit=typeof options.arrayLimit==="number"?options.arrayLimit:internals.arrayLimit;options.parseArrays=options.parseArrays!==false;options.allowDots=typeof options.allowDots==="boolean"?options.allowDots:internals.allowDots;options.plainObjects=typeof options.plainObjects==="boolean"?options.plainObjects:internals.plainObjects;options.allowPrototypes=typeof options.allowPrototypes==="boolean"?options.allowPrototypes:internals.allowPrototypes;options.parameterLimit=typeof options.parameterLimit==="number"?options.parameterLimit:internals.parameterLimit;options.strictNullHandling=typeof options.strictNullHandling==="boolean"?options.strictNullHandling:internals.strictNullHandling;if(str===""||str===null||typeof str==="undefined"){return options.plainObjects?Object.create(null):{}}var tempObj=typeof str==="string"?internals.parseValues(str,options):str;var obj=options.plainObjects?Object.create(null):{};var keys=Object.keys(tempObj);for(var i=0;i<keys.length;++i){var key=keys[i];var newObj=internals.parseKeys(key,tempObj[key],options);obj=Utils.merge(obj,newObj,options)}return Utils.compact(obj)}},{"./utils":4}],3:[function(require,module,exports){"use strict";var Utils=require("./utils");var internals={delimiter:"&",arrayPrefixGenerators:{brackets:function(prefix){return prefix+"[]"},indices:function(prefix,key){return prefix+"["+key+"]"},repeat:function(prefix){return prefix}},strictNullHandling:false,skipNulls:false,encode:true};internals.stringify=function(object,prefix,generateArrayPrefix,strictNullHandling,skipNulls,encode,filter,sort,allowDots){var obj=object;if(typeof filter==="function"){obj=filter(prefix,obj)}else if(Utils.isBuffer(obj)){obj=String(obj)}else if(obj instanceof Date){obj=obj.toISOString()}else if(obj===null){if(strictNullHandling){return encode?Utils.encode(prefix):prefix}obj=""}if(typeof obj==="string"||typeof obj==="number"||typeof obj==="boolean"){if(encode){return[Utils.encode(prefix)+"="+Utils.encode(obj)]}return[prefix+"="+obj]}var values=[];if(typeof obj==="undefined"){return values}var objKeys;if(Array.isArray(filter)){objKeys=filter}else{var keys=Object.keys(obj);objKeys=sort?keys.sort(sort):keys}for(var i=0;i<objKeys.length;++i){var key=objKeys[i];if(skipNulls&&obj[key]===null){continue}if(Array.isArray(obj)){values=values.concat(internals.stringify(obj[key],generateArrayPrefix(prefix,key),generateArrayPrefix,strictNullHandling,skipNulls,encode,filter,sort,allowDots))}else{values=values.concat(internals.stringify(obj[key],prefix+(allowDots?"."+key:"["+key+"]"),generateArrayPrefix,strictNullHandling,skipNulls,encode,filter,sort,allowDots))}}return values};module.exports=function(object,opts){var obj=object;var options=opts||{};var delimiter=typeof options.delimiter==="undefined"?internals.delimiter:options.delimiter;var strictNullHandling=typeof options.strictNullHandling==="boolean"?options.strictNullHandling:internals.strictNullHandling;var skipNulls=typeof options.skipNulls==="boolean"?options.skipNulls:internals.skipNulls;var encode=typeof options.encode==="boolean"?options.encode:internals.encode;var sort=typeof options.sort==="function"?options.sort:null;var allowDots=typeof options.allowDots==="undefined"?false:options.allowDots;var objKeys;var filter;if(typeof options.filter==="function"){filter=options.filter;obj=filter("",obj)}else if(Array.isArray(options.filter)){objKeys=filter=options.filter}var keys=[];if(typeof obj!=="object"||obj===null){return""}var arrayFormat;if(options.arrayFormat in internals.arrayPrefixGenerators){arrayFormat=options.arrayFormat}else if("indices"in options){arrayFormat=options.indices?"indices":"repeat"}else{arrayFormat="indices"}var generateArrayPrefix=internals.arrayPrefixGenerators[arrayFormat];if(!objKeys){objKeys=Object.keys(obj)}if(sort){objKeys.sort(sort)}for(var i=0;i<objKeys.length;++i){var key=objKeys[i];if(skipNulls&&obj[key]===null){continue}keys=keys.concat(internals.stringify(obj[key],key,generateArrayPrefix,strictNullHandling,skipNulls,encode,filter,sort,allowDots))}return keys.join(delimiter)}},{"./utils":4}],4:[function(require,module,exports){"use strict";var hexTable=function(){var array=new Array(256);for(var i=0;i<256;++i){array[i]="%"+((i<16?"0":"")+i.toString(16)).toUpperCase()}return array}();exports.arrayToObject=function(source,options){var obj=options.plainObjects?Object.create(null):{};for(var i=0;i<source.length;++i){if(typeof source[i]!=="undefined"){obj[i]=source[i]}}return obj};exports.merge=function(target,source,options){if(!source){return target}if(typeof source!=="object"){if(Array.isArray(target)){target.push(source)}else if(typeof target==="object"){target[source]=true}else{return[target,source]}return target}if(typeof target!=="object"){return[target].concat(source)}var mergeTarget=target;if(Array.isArray(target)&&!Array.isArray(source)){mergeTarget=exports.arrayToObject(target,options)}return Object.keys(source).reduce(function(acc,key){var value=source[key];if(Object.prototype.hasOwnProperty.call(acc,key)){acc[key]=exports.merge(acc[key],value,options)}else{acc[key]=value}return acc},mergeTarget)};exports.decode=function(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(e){return str}};exports.encode=function(str){if(str.length===0){return str}var string=typeof str==="string"?str:String(str);var out="";for(var i=0;i<string.length;++i){var c=string.charCodeAt(i);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122){out+=string.charAt(i);continue}if(c<128){out=out+hexTable[c];continue}if(c<2048){out=out+(hexTable[192|c>>6]+hexTable[128|c&63]);continue}if(c<55296||c>=57344){out=out+(hexTable[224|c>>12]+hexTable[128|c>>6&63]+hexTable[128|c&63]);continue}i+=1;c=65536+((c&1023)<<10|string.charCodeAt(i)&1023);out+=hexTable[240|c>>18]+hexTable[128|c>>12&63]+hexTable[128|c>>6&63]+hexTable[128|c&63]}return out};exports.compact=function(obj,references){if(typeof obj!=="object"||obj===null){return obj}var refs=references||[];var lookup=refs.indexOf(obj);if(lookup!==-1){return refs[lookup]}refs.push(obj);if(Array.isArray(obj)){var compacted=[];for(var i=0;i<obj.length;++i){if(typeof obj[i]!=="undefined"){compacted.push(obj[i])}}return compacted}var keys=Object.keys(obj);for(var j=0;j<keys.length;++j){var key=keys[j];obj[key]=exports.compact(obj[key],refs)}return obj};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.isBuffer=function(obj){if(obj===null||typeof obj==="undefined"){return false}return!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))}},{}],5:[function(require,module,exports){var AnimatedSprite,makeFrames;makeFrames=require("../helper/make-frames");module.exports=AnimatedSprite=function(){function AnimatedSprite(path,group){var animation,name,ref;this.path=path;this.sprite=group.create(0,0,"sprites");this.sprite.obj=this;this.animations=this.sprite.animations;this.scale=this.sprite.scale;this.sprite.anchor.setTo(.5,1);ref=makeFrames("actor",this.path);for(name in ref){animation=ref[name];this.animations.add(name,animation,8,true)}this.pos=this.sprite.position;this.animations.play("walk/s")}AnimatedSprite.prototype.destroy=function(){return room.remove(this)};AnimatedSprite.prototype.replaceWith=function(other){this.destroy();other.pos.copyFrom(this.pos);other.scale.copyFrom(this.scale);room.sortEntities();return other};return AnimatedSprite}()},{"../helper/make-frames":15}],6:[function(require,module,exports){var LocalController;module.exports=LocalController=function(){function LocalController(obj){this.obj=obj;this.uid=null}LocalController.prototype.send=function(type,data){if(!(this.uid!=null&&(typeof connection!=="undefined"&&connection!==null))){return}data=Object.assign({type:type,uid:this.uid},data,{x:this.obj.pos.x,y:this.obj.pos.y});return connection.send(data)};LocalController.prototype.update=function(){var dir;dir="";if(game.input.keyboard.isDown(Phaser.Keyboard.UP)){dir+="n"}if(game.input.keyboard.isDown(Phaser.Keyboard.DOWN)){dir+="s"}if(game.input.keyboard.isDown(Phaser.Keyboard.LEFT)){dir+="w"}if(game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)){dir+="e"}if(dir){return this.walk(dir)}else{return this.stop()}};LocalController.prototype.walk=function(dir){if(dir===this.obj.moveDir){return}this.send("walk",{dir:dir});return this.obj.walk(dir)};LocalController.prototype.stop=function(){if(!this.obj.moveDir){return}this.send("stop");this.prevDir=null;return this.obj.stop()};return LocalController}()},{}],7:[function(require,module,exports){var RemoteController;module.exports=RemoteController=function(){function RemoteController(obj){this.obj=obj;this.commands=[]}RemoteController.prototype.update=function(){var cmd,name,results;results=[];while(cmd=this.commands.pop()){if(typeof this[name="exec_"+cmd.type]==="function"){this[name](cmd)}results.push(this.obj.pos.setTo(cmd.x,cmd.y))}return results};RemoteController.prototype.exec_pos=function(cmd){return this.obj.pos.setTo(cmd.x,cmd.y)};RemoteController.prototype.exec_walk=function(cmd){return this.obj.walk(cmd.dir)};RemoteController.prototype.exec_stop=function(){return this.obj.stop()};return RemoteController}()},{}],8:[function(require,module,exports){var CatBurglar,Player,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Player=require("./index");module.exports=CatBurglar=function(superClass){extend(CatBurglar,superClass);function CatBurglar(group){CatBurglar.__super__.constructor.call(this,"cat",group);this.colorFilter.uniforms.colors.value=[1/2,1/4,1/8,0/1,1/1,0/1,1/8,1/6,1/3]}return CatBurglar}(Player)},{"./index":9}],9:[function(require,module,exports){var AnimatedSprite,ColorChange,Player,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;AnimatedSprite=require("../animated-sprite");ColorChange=require("../../filters/color-change");module.exports=Player=function(superClass){extend(Player,superClass);function Player(){Player.__super__.constructor.apply(this,arguments);this.colorFilter=new ColorChange;this.sprite.filters=[this.colorFilter];this.sprite.animations.play("walk/se");this.speed=1;this.moveDir=null}Player.prototype.update=function(){var x,y;if(this.moveDir){x=!!~this.moveDir.indexOf("e")-!!~this.moveDir.indexOf("w");y=!!~this.moveDir.indexOf("s")-!!~this.moveDir.indexOf("n");return this.pos.add(x*this.speed,y*this.speed)}};Player.prototype.walk=function(dir){this.moveDir=dir;if(~dir.indexOf("e")){this.scale.x=1}if(~dir.indexOf("w")){this.scale.x=-1}return this.animations.play("walk/"+dir.replace("w","e"))};Player.prototype.stop=function(){return this.moveDir=null};return Player}(AnimatedSprite)},{"../../filters/color-change":11,"../animated-sprite":5}],10:[function(require,module,exports){var Cat,LocalController,ScaleManager,resize,transformPosition;resize=require("./helper/resize");transformPosition=require("./helper/transform-position");Cat=require("./actor/player/cat");LocalController=require("./actor/controller/local-controller");ScaleManager=Phaser.ScaleManager;module.exports=function(){var stopper;window.globals=this;this.world=game.add.group();stopper=game.add.image();stopper.position.y=140;this.world.add(stopper);this.sprites=[];this.controllers=[];this.player=new Cat(this.world);this.player.pos.setTo(100,60);window.player=this.player;this.controller=new LocalController(player);this.sprites.push(this.player);this.controllers.push(this.controller);this.events=[];game.scale.fullScreenScaleMode=ScaleManager.SHOW_ALL;resize.call(this);window.addEventListener("resize",resize.bind(this));return this.stage.disableVisibilityChange=true}},{"./actor/controller/local-controller":6,"./actor/player/cat":8,"./helper/resize":16,"./helper/transform-position":17}],11:[function(require,module,exports){var ColorChange,glsl,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;glsl=require("./glsl/color-change");module.exports=ColorChange=function(superClass){extend(ColorChange,superClass);function ColorChange(){ColorChange.__super__.constructor.apply(this,arguments);this.uniforms.colors={type:"mat3",value:[1/2,1/4,1/8,0,1,0,1/8,1/6,1/3]};this.fragmentSrc=[glsl]}return ColorChange}(Phaser.Filter)},{"./glsl/color-change":12}],12:[function(require,module,exports){module.exports="precision mediump float;\r\nvarying vec2 vTextureCoord;\r\nuniform mat3 colors;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void){\r\n  vec4 color = texture2D(uSampler, vTextureCoord);\r\n  gl_FragColor = vec4(\r\n    colors[0] * color.r +\r\n    colors[1] * color.g +\r\n    colors[2] * color.b,\r\n    color.a\r\n  );\r\n}\r\n\r\n"},{}],13:[function(require,module,exports){module.exports=function(){var hScale,vScale;hScale=window.innerWidth/WIDTH;vScale=window.innerHeight/HEIGHT;return window.SCALE=Math.max(1,Math.floor(Math.min(hScale,vScale)))}},{}],14:[function(require,module,exports){module.exports=function(arr,funcName){var a,i,len,ref;ref=arr.slice();for(i=0,len=ref.length;i<len;i++){a=ref[i];if(typeof a[funcName]==="function"){a[funcName]()}}return arr}},{}],15:[function(require,module,exports){module.exports=function(namespace,path){var components,i,key,len,name,names,ret,start;ret={};names=Object.keys(game.cache._cache.image.sprites.frameData._frameNames);start=namespace==="actor"?4:5;for(i=0,len=names.length;i<len;i++){name=names[i];components=name.split("/");if(!(namespace===components[2]&&path===components[3])){continue}key=components.slice(start,-1).join("/");key||(key=components[start]);if(!key){continue}(ret[key]||(ret[key]=[])).push(name)}return ret}},{}],16:[function(require,module,exports){var getScale;getScale=require("./get-scale");module.exports=function(scale){var height,width;window.SCALE=getScale();width=WIDTH*SCALE;height=HEIGHT*SCALE;this.world.scale.setTo(SCALE,SCALE);game.width=width;game.height=height;game.stage.width=width;game.stage.height=height;if(game.renderType===Phaser.WEBGL){return game.renderer.resize(width,height)}}},{"./get-scale":13}],17:[function(require,module,exports){module.exports=function(touch){touch.$transformed=true;return touch.position.setTo(touch.position.x/SCALE,touch.position.y/SCALE)}},{}],18:[function(require,module,exports){var AUTO,Game,getScale,initPeer;window.puts=console.log.bind(console);getScale=require("./helper/get-scale");require("./mixins");initPeer=require("./net/peer");window.WIDTH=200;window.HEIGHT=120;window.SCALE=getScale();Game=Phaser.Game,AUTO=Phaser.AUTO;window.onload=function(){window.game=new Game(WIDTH*SCALE,HEIGHT*SCALE,Phaser.AUTO,null,{preload:require("./preload"),create:require("./create"),update:require("./update")},false,false);return initPeer()}},{"./create":10,"./helper/get-scale":13,"./mixins":19,"./net/peer":20,"./preload":21,"./update":22}],19:[function(require,module,exports){var slice=[].slice;Math.sign||(Math.sign=function(v){if(v<0){return-1}else{return 1}});Object.assign||(Object.assign=function(){var i,j,key,len,len1,ref,source,sources,target;target=arguments[0],sources=2<=arguments.length?slice.call(arguments,1):[];for(i=0,len=sources.length;i<len;i++){source=sources[i];ref=Object.keys(source||{});for(j=0,len1=ref.length;j<len1;j++){key=ref[j];target[key]=source[key]}}return target})},{}],20:[function(require,module,exports){var Cat,RemoteController,addPlayer,connectTo,handleConnection,host,makePeer,qs,uid;qs=require("qs");RemoteController=require("../actor/controller/remote-controller");Cat=require("../actor/player/cat");uid=0;makePeer=function(){return window.peer=new Peer({key:"sb544jx9pnj3jtt9"})};connectTo=function(id){var conn;makePeer();conn=peer.connect(id);return conn.on("open",function(){return handleConnection(conn)})};addPlayer=function(uid){var controller,player;player=new Cat(globals.world);controller=new RemoteController(player);globals.sprites.push(player);globals.controllers.push(controller);controller.uid=uid;return controller};host=function(){makePeer();peer.on("open",function(id){globals.controller.uid=uid++;return prompt("Copy and paste this url to your friend:",location.href+"?peer="+id)});return peer.on("connection",function(conn){puts("Player connecting:",conn.peer);return conn.on("open",function(){var controller;controller=addPlayer(uid++);conn.send({uid:controller.uid,type:"your uid"});conn.send({uid:globals.controller.uid,type:"new player",x:globals.player.pos.x,y:globals.player.pos.y});return handleConnection(conn)})})};handleConnection=function(conn){window.connection=conn;return conn.on("data",function(data){var ctrl;switch(data.type){case"your uid":globals.controller.uid=data.uid;return globals.controller.send("pos");case"new player":ctrl=addPlayer(data.uid);return ctrl.obj.pos.setTo(data.x,data.y);default:return globals.controllers.find(function(c){return c.uid===data.uid}).commands.push(data)}})};module.exports=function(){var button,query;query=location.href.split("?").pop();query=qs.parse(query);if(query.peer){return connectTo(query.peer)}else{button=document.createElement("button");button.textContent="Host";document.body.appendChild(button);return button.addEventListener("click",host)}}},{"../actor/controller/remote-controller":7,"../actor/player/cat":8,qs:1}],21:[function(require,module,exports){module.exports=function(){this.stage.disableVisbilityChange=true;return this.load.atlasJSONHash("sprites","./build/image/sprites.png","./build/image/sprites.json")}},{}],22:[function(require,module,exports){var invoke;invoke=require("./helper/invoke");module.exports=function(a){invoke(this.controllers,"update");return invoke(this.sprites,"update")}},{"./helper/invoke":14}]},{},[18]);