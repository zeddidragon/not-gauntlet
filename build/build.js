(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var AnimatedSprite,arrayRemove,makeFrames;makeFrames=require("../helper/make-frames");arrayRemove=require("../helper/array/remove");module.exports=AnimatedSprite=function(){function AnimatedSprite(path,group){var animation,name,ref;this.path=path;this.sprite=group.create(0,0,"sprites");this.sprite.obj=this;this.animations=this.sprite.animations;this.scale=this.sprite.scale;this.sprite.anchor.setTo(.5,1);ref=makeFrames("actor",this.path);for(name in ref){animation=ref[name];this.animations.add(name,animation,8,true)}this.pos=this.sprite.position;this.animations.play("walk/s")}AnimatedSprite.prototype.destroy=function(){arrayRemove(globals.sprites,this);return this.sprite.destroy()};AnimatedSprite.prototype.replaceWith=function(other){this.destroy();other.pos.copyFrom(this.pos);other.scale.copyFrom(this.scale);room.sortEntities();return other};return AnimatedSprite}()},{"../helper/array/remove":10,"../helper/make-frames":14}],2:[function(require,module,exports){var Axis,Button,Input,KB,PAD,clamp,invoke;clamp=require("../../helper/clamp");invoke=require("../../helper/invoke");Button=function(){Button.prototype.held=false;Button.prototype.pressed=false;Button.prototype.released=false;function Button(cb){this.cb=cb}Button.prototype.update=function(){var input;this.pressed&&(this.pressed=false);this.released&&(this.released=false);input=this.cb();if(!this.held&&input){this.held=true;this.pressed=true}if(this.held&&!input){this.held=false;this.released=false}return this.held};return Button}();Axis=function(){Axis.prototype.val=0;function Axis(cb){this.cb=cb}Axis.prototype.update=function(){return this.val=this.cb()};Axis.prototype.valueOf=function(){return this.val};return Axis}();KB=Phaser.Keyboard;PAD=Phaser.Gamepad;module.exports=Input=function(){function Input(opts){var kb,pad;this.inputs=[];if(opts.gamepad){game.input.gamepad.start();pad=game.input.gamepad["pad"+opts.gamepad]}if(opts.keyboard){kb=game.input.keyboard}this.inputs.push(this.lx=new Axis(function(){var ret;ret=0;if(kb){ret-=kb.isDown(KB.LEFT);ret+=kb.isDown(KB.RIGHT);ret-=kb.isDown(KB.A);ret+=kb.isDown(KB.D)}if(pad){ret-=pad.isDown(PAD.XBOX360_DPAD_LEFT);ret+=pad.isDown(PAD.XBOX360_DPAD_RIGHT);ret+=pad.axis(0)}return clamp(ret,-1,1)}));this.inputs.push(this.ly=new Axis(function(){var ret;ret=0;if(kb){ret-=kb.isDown(KB.UP);ret+=kb.isDown(KB.DOWN);ret-=kb.isDown(KB.W);ret+=kb.isDown(KB.S)}if(pad){ret-=pad.isDown(PAD.XBOX360_DPAD_UP);ret+=pad.isDown(PAD.XBOX360_DPAD_DOWN);ret+=pad.axis(1)}return clamp(ret,-1,1)}));this.inputs.push(this.a=new Button(function(){if(kb){if(kb.isDown(KB.Z)){return true}if(kb.isDown(KB.J)){return true}}if(pad){if(pad.isDown(PAD.XBOX360_A)){return true}}return false}));this.inputs.push(this.b=new Button(function(){if(kb){if(kb.isDown(KB.X)){return true}if(kb.isDown(KB.I)){return true}}if(pad){if(pad.isDown(PAD.XBOX360_X)){return true}}return false}))}Input.prototype.update=function(){return invoke(this.inputs,"update")};return Input}()},{"../../helper/clamp":11,"../../helper/invoke":13}],3:[function(require,module,exports){var Input,LocalController,RemoteController,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;RemoteController=require("./remote-controller");Input=require("./input");module.exports=LocalController=function(superClass){extend(LocalController,superClass);function LocalController(){LocalController.__super__.constructor.apply(this,arguments);window.controller=this;this.input=new Input({keyboard:true,gamepad:1});this.send("player joined")}LocalController.prototype.send=function(type,data){return this.outbound.push(this.createMessage(type,data))};LocalController.prototype.update=function(){var x,y;this.input.update();x=+this.input.lx;y=+this.input.ly;if(x||y){return this.walk(x,y)}else{return this.stop()}};LocalController.prototype.walk=function(x,y){if(x===this.obj.moveX&&y===this.obj.moveY){return}this.send("walk",{x:x,y:y});return this.obj.walk(x,y)};LocalController.prototype.stop=function(){if(!(this.obj.moveX||this.obj.moveY)){return}this.send("stop");return this.obj.stop()};return LocalController}(RemoteController)},{"./input":2,"./remote-controller":4}],4:[function(require,module,exports){var RemoteController,arrayRemove;arrayRemove=require("../../helper/array/remove");module.exports=RemoteController=function(){function RemoteController(uid,obj,connectionId){this.uid=uid;this.obj=obj;this.connectionId=connectionId;this.inbound=[];this.outbound=[]}RemoteController.prototype.createMessage=function(type,data){return Object.assign({_type_:type,uid:this.uid},data,{x:this.obj.pos.x,y:this.obj.pos.y})};RemoteController.prototype.update=function(){var cmd,name,results;results=[];while(cmd=this.inbound.pop()){if(typeof this[name="exec_"+cmd._type_]==="function"){this[name](cmd)}results.push(this.obj.pos.setTo(cmd.x,cmd.y))}return results};RemoteController.prototype.destroy=function(){arrayRemove(globals.controllers,this);return this.obj.destroy()};RemoteController.prototype.exec_walk=function(cmd){return this.obj.walk(cmd.dir)};RemoteController.prototype.exec_stop=function(){return this.obj.stop()};return RemoteController}()},{"../../helper/array/remove":10}],5:[function(require,module,exports){var CatBurglar,Player,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Player=require("./index");module.exports=CatBurglar=function(superClass){extend(CatBurglar,superClass);function CatBurglar(group){CatBurglar.__super__.constructor.call(this,"cat",group);this.colorFilter.uniforms.colors.value=[1/2,1/4,1/8,0/1,1/1,0/1,1/8,1/6,1/3]}return CatBurglar}(Player)},{"./index":6}],6:[function(require,module,exports){var AnimatedSprite,ColorChange,Player,clamp,tmp,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;AnimatedSprite=require("../animated-sprite");ColorChange=require("../../filters/color-change");clamp=require("../../helper/clamp");tmp=new Phaser.Point;module.exports=Player=function(superClass){extend(Player,superClass);Player.prototype.moveX=0;Player.prototype.moveY=0;function Player(){Player.__super__.constructor.apply(this,arguments);this.colorFilter=new ColorChange;this.sprite.filters=[this.colorFilter];this.sprite.animations.play("walk/se");this.speed=1}Player.prototype.update=function(){this.pos.add(this.moveX,this.moveY);this.pos.x=clamp(this.pos.x,4,WIDTH-4);return this.pos.y=clamp(this.pos.y,16,HEIGHT)};Player.prototype.walk=function(x,y){var dir;tmp.setTo(x,y);if(tmp.getMagnitude()>1){tmp.normalize()}this.moveX=tmp.x;this.moveY=tmp.y;dir="";if(tmp.y<=-.4*Math.abs(tmp.x)){dir+="n"}if(tmp.y>=.4*Math.abs(tmp.x)){dir+="s"}if(Math.abs(tmp.x)>=.4*Math.abs(tmp.y)){dir+="e"}if(x>0){this.scale.x=1}if(x<0){this.scale.x=-1}if(dir){return this.animations.play("walk/"+dir)}};Player.prototype.stop=function(){this.moveX=0;return this.moveY=0};return Player}(AnimatedSprite)},{"../../filters/color-change":8,"../../helper/clamp":11,"../animated-sprite":1}],7:[function(require,module,exports){var ScaleManager,resize,spawnLocalPlayer,transformPosition;resize=require("./helper/resize");transformPosition=require("./helper/transform-position");spawnLocalPlayer=require("./net/spawn-local-player");ScaleManager=Phaser.ScaleManager;module.exports=function(){var stopper;globals.world=game.add.group();stopper=game.add.image();stopper.position.y=140;globals.world.add(stopper);globals.sprites=[];globals.controllers=[];globals.connections=[];globals.events=[];game.scale.fullScreenScaleMode=ScaleManager.SHOW_ALL;resize.call(this);window.addEventListener("resize",resize.bind(this));this.stage.disableVisibilityChange=true;return spawnLocalPlayer(0,{x:100,y:60},"derp")}},{"./helper/resize":15,"./helper/transform-position":16,"./net/spawn-local-player":20}],8:[function(require,module,exports){var ColorChange,glsl,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;glsl=require("./glsl/color-change");module.exports=ColorChange=function(superClass){extend(ColorChange,superClass);function ColorChange(){ColorChange.__super__.constructor.apply(this,arguments);this.uniforms.colors={type:"mat3",value:[1/2,1/4,1/8,0,1,0,1/8,1/6,1/3]};this.fragmentSrc=[glsl]}return ColorChange}(Phaser.Filter)},{"./glsl/color-change":9}],9:[function(require,module,exports){module.exports="precision mediump float;\r\nvarying vec2 vTextureCoord;\r\nuniform mat3 colors;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void){\r\n  vec4 color = texture2D(uSampler, vTextureCoord);\r\n  gl_FragColor = vec4(\r\n    colors[0] * color.r +\r\n    colors[1] * color.g +\r\n    colors[2] * color.b,\r\n    color.a\r\n  );\r\n}\r\n\r\n"},{}],10:[function(require,module,exports){module.exports=function(arr,item){var index;index=arr.indexOf(item);if(index<0){return arr}arr[index]=arr[arr.length-1];arr.pop();return arr}},{}],11:[function(require,module,exports){module.exports=function(val,min,max){return Math.max(min,Math.min(val,max))}},{}],12:[function(require,module,exports){module.exports=function(){var hScale,vScale;hScale=window.innerWidth/WIDTH;vScale=window.innerHeight/HEIGHT;return window.SCALE=Math.max(1,Math.floor(Math.min(hScale,vScale)))}},{}],13:[function(require,module,exports){module.exports=function(arr,funcName){var a,i,len,ref;ref=arr.slice();for(i=0,len=ref.length;i<len;i++){a=ref[i];if(typeof a[funcName]==="function"){a[funcName]()}}return arr}},{}],14:[function(require,module,exports){module.exports=function(namespace,path){var components,i,key,len,name,names,ret,start;ret={};names=Object.keys(game.cache._cache.image.sprites.frameData._frameNames);start=namespace==="actor"?4:5;for(i=0,len=names.length;i<len;i++){name=names[i];components=name.split("/");if(!(namespace===components[2]&&path===components[3])){continue}key=components.slice(start,-1).join("/");key||(key=components[start]);if(!key){continue}(ret[key]||(ret[key]=[])).push(name)}return ret}},{}],15:[function(require,module,exports){var getScale;getScale=require("./get-scale");module.exports=function(scale){var height,width;window.SCALE=getScale();width=WIDTH*SCALE;height=HEIGHT*SCALE;this.world.scale.setTo(SCALE,SCALE);game.width=width;game.height=height;game.stage.width=width;game.stage.height=height;if(game.renderType===Phaser.WEBGL){return game.renderer.resize(width,height)}}},{"./get-scale":12}],16:[function(require,module,exports){module.exports=function(touch){touch.$transformed=true;return touch.position.setTo(touch.position.x/SCALE,touch.position.y/SCALE)}},{}],17:[function(require,module,exports){var AUTO,Game,getScale;window.puts=console.log.bind(console);window.globals={};getScale=require("./helper/get-scale");require("./mixins");window.WIDTH=200;window.HEIGHT=120;window.SCALE=getScale();Game=Phaser.Game,AUTO=Phaser.AUTO;window.onload=function(){return window.game=new Game(WIDTH*SCALE,HEIGHT*SCALE,Phaser.AUTO,null,{preload:require("./preload"),create:require("./create"),update:require("./update")},false,false)}},{"./create":7,"./helper/get-scale":12,"./mixins":18,"./preload":21,"./update":22}],18:[function(require,module,exports){var slice=[].slice;Math.sign||(Math.sign=function(v){if(v<0){return-1}else{return 1}});Object.assign||(Object.assign=function(){var i,j,key,len,len1,ref,source,sources,target;target=arguments[0],sources=2<=arguments.length?slice.call(arguments,1):[];for(i=0,len=sources.length;i<len;i++){source=sources[i];ref=Object.keys(source||{});for(j=0,len1=ref.length;j<len1;j++){key=ref[j];target[key]=source[key]}}return target})},{}],19:[function(require,module,exports){module.exports=function(){var cmd,conn,ctrl,i,len,ref,results;ref=globals.controllers;results=[];for(i=0,len=ref.length;i<len;i++){ctrl=ref[i];results.push(function(){var results1;results1=[];while(cmd=ctrl.outbound.pop()){results1.push(function(){var j,len1,ref1,results2;ref1=globals.connections;results2=[];for(j=0,len1=ref1.length;j<len1;j++){conn=ref1[j];results2.push(conn.send(cmd))}return results2}())}return results1}())}return results}},{}],20:[function(require,module,exports){var Cat,LocalController;Cat=require("../actor/player/cat");LocalController=require("../actor/controller/local-controller");module.exports=function(uid,data,connectionId){globals.player=new Cat(globals.world);globals.player.pos.setTo(100,60);window.player=globals.player;globals.controller=new LocalController(uid,player,connectionId);globals.sprites.push(globals.player);return globals.controllers.push(globals.controller)}},{"../actor/controller/local-controller":3,"../actor/player/cat":5}],21:[function(require,module,exports){module.exports=function(){this.stage.disableVisbilityChange=true;return this.load.atlasJSONHash("sprites","./build/image/sprites.png","./build/image/sprites.json")}},{}],22:[function(require,module,exports){var invoke,sendOutbound;invoke=require("./helper/invoke");sendOutbound=require("./net/send-outbound");module.exports=function(){invoke(globals.controllers,"update");invoke(globals.sprites,"update");sendOutbound();return invoke(globals.connections,"update")}},{"./helper/invoke":13,"./net/send-outbound":19}]},{},[17]);